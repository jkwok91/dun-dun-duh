{% extends "layout.html" %}

{% block head %}
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jquery-jcrop/0.9.12/css/jquery.Jcrop.min.css" type="text/css" />
{% endblock %}

{% block body %}
<h1>Crop on Face</h1>
<img src="{{ url_for("uploaded_file", filename=filename) }}" alt="Loading..." id="base-image" />
<form method="POST" action="{{ url_for("compose", filename=filename) }}">
	<input type="hidden" name="x" value="{{ x }}" />
	<input type="hidden" name="y" value="{{ y }}" />
	<input type="hidden" name="size" value="{{ size }}" />
	<button type="submit" disabled="disabled">Create My Gif</button>
</form>
{% endblock %}

{% block script %}
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-jcrop/0.9.12/js/jquery.Jcrop.min.js"></script>
	<script>
		$(function () {
			$('#base-image').Jcrop({
				aspectRatio: 1,
				minSize: [10, 10],
				maxSize: [{{ max_size }}, {{ max_size }}],
				allowSelect: false,
				setSelect: [{{ x }}, {{ y }}, {{ x + size }}, {{ y + size }}],
				onSelect: function (c) {
					$('input[name=x]').val(c.x);
					$('input[name=y]').val(c.y);
					$('input[name=size]').val(c.w);
					$('button').attr('disabled', false);
				}
			});
		});
	</script>
{% endblock %}
